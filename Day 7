Day 7 – HAVING Clause

Focus: Filtering aggregated results, refining insights after grouping, and uncovering patterns among groups.

✅ Learnings:

- HAVING filters groups created by GROUP BY based on aggregate conditions.
- Unlike WHERE, which filters rows before aggregation, HAVING filters after aggregation.
- Common aggregate functions used with HAVING: COUNT, SUM, AVG, MIN, MAX.
- Combine multiple conditions in HAVING using AND / OR.

✅ Practice Questions:

-- 1.Find services that have admitted more than 500 patients in total.
select
service,
sum(patients_admitted) as total_patients
from services_weekly
group by service
having sum(patients_admitted) > 500;

-- 2. Show services where average patient satisfaction is below 75.
select
service,
avg(patient_satisfaction) as avg_patient_satisfied
from services_weekly
group by service
having avg(patient_satisfaction) < 75;


-- 3. List weeks where total staff presence across all services was less than 50.
select
week,
sum(present) as total_staff
from staff_schedule
group by week
having  sum(present) < 50;


-- Day 7 Question: Identify services that refused more than 100 patients in total and had an average patient satisfaction below 80. 
-- Show service name, total refused, and average satisfaction.

select
service as service_name,
sum(patients_refused) as total_refused,
round(avg(patient_satisfaction),2) as average_satisfaction
from services_weekly
group by service
having sum(patients_refused) > 100 And avg(patient_satisfaction) < 80;

